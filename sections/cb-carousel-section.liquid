{% comment %}
Multi-slide Slideshow (uses Horizon's existing slideshow.js + slideshow snippet)
- Add as a new section. Each block = one slide (type: _slide), same as the native slideshow.
- Controls how many slides are visible per breakpoint with CSS vars.
- Works with arrows/dots/autoplay from the original slideshow.
{% endcomment %}

{% capture slides %}
  {% content_for 'blocks' %}
{% endcapture %}

{% liquid
  assign show_arrows = true
  if section.settings.icons_style == 'none' or section.blocks.size <= 1
    assign show_arrows = false
  endif
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<div
  class="spacing-style section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }} disable-section-top-offset"
  style="{% render 'spacing-padding', settings: section.settings %}"
>
  {%- comment -%}
  We pass a custom class "slideshow--multi" and sizing vars for visible slides + gap.
  The slideshow snippet will still output its normal markup; our CSS below sets flex-basis to show N per view.
  {%- endcomment -%}
  {% render 'slideshow',
    class: 'slideshow--multi',
    controls: section.blocks.size > 1
      ? render 'slideshow-controls',
        style: section.settings.slideshow_controls_style,
        autoplay: section.settings.autoplay,
        item_count: section.blocks.size,
        show_arrows: false,
        arrows_on_media: true,
        controls_on_media: true,
        pagination_position: 'center',
        icon_style: section.settings.icons_style
      : '',
    show_arrows: show_arrows,
    icon_style: section.settings.icons_style,
    autoplay: section.settings.autoplay,
    autoplay_speed: section.settings.autoplay_speed,
    slides: slides,
    slide_count: section.blocks.size,
    slide_size: 'auto'  /* critical: let slides size themselves so we can show multiple */
  %}

  <style>
    /* Keep it local to this section instance using its id */
    #shopify-section-{{ section.id }} .slideshow--multi {
      --slides-desktop: {{ section.settings.slides_desktop | default: 4 }};
      --slides-tablet:  {{ section.settings.slides_tablet  | default: 3 }};
      --slides-mobile:  {{ section.settings.slides_mobile  | default: 1.5 }};
      --slide-gap: {{ section.settings.columns_gap | default: 12 }}px;
      --visible: var(--slides-desktop);
    }

    /* The slideshow snippet outputs a list/track + slides; we size per item here.
       These classnames are used across Horizon. If your theme differs, adjust selectors:
       - .slideshow__slides : flex track
       - .slideshow__slide  : each slide item
    */
    #shopify-section-{{ section.id }} .slideshow--multi .slideshow__slides {
      display: flex;
      gap: var(--slide-gap);
      scroll-snap-type: x mandatory; /* keeps that snappy drag feel */
    }

    #shopify-section-{{ section.id }} .slideshow--multi .slideshow__slide {
      flex: 0 0 calc((100% - (var(--visible) - 1) * var(--slide-gap)) / var(--visible));
      scroll-snap-align: start;
    }

    /* Tablet */
    @media (max-width: 1024px) {
      #shopify-section-{{ section.id }} .slideshow--multi { --visible: var(--slides-tablet); }
    }

    /* Mobile */
    @media (max-width: 640px) {
      #shopify-section-{{ section.id }} .slideshow--multi { --visible: var(--slides-mobile); }
    }
  </style>
</div>

{% schema %}
{
  "name": "Multi-slide slideshow",
  "class": "container-background-image",
  "blocks": [
    { "type": "_slide" }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "select",
      "id": "icons_style",
      "label": "Navigation",
      "options": [
        { "value": "arrow", "label": "Arrows" },
        { "value": "chevron", "label": "Chevrons" },
        { "value": "arrows_large", "label": "Large arrows" },
        { "value": "chevron_large", "label": "Large chevrons" },
        { "value": "none", "label": "None" }
      ],
      "default": "arrow"
    },
    {
      "type": "select",
      "id": "slideshow_controls_style",
      "label": "Pagination",
      "options": [
        { "value": "dots", "label": "Dots" },
        { "value": "counter", "label": "Counter" }
      ],
      "default": "dots"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "primary"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Speed",
      "min": 3, "max": 7, "step": 1,
      "unit": "s",
      "default": 4,
      "visible_if": "{{ section.settings.autoplay }}"
    },

    { "type": "header", "content": "Slides per view" },
    {
      "type": "range",
      "id": "slides_desktop",
      "label": "Desktop",
      "min": 1, "max": 8, "step": 0.5, "default": 4
    },
    {
      "type": "range",
      "id": "slides_tablet",
      "label": "Tablet",
      "min": 1, "max": 6, "step": 0.5, "default": 3
    },
    {
      "type": "range",
      "id": "slides_mobile",
      "label": "Mobile",
      "min": 1, "max": 4, "step": 0.5, "default": 1.5
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Horizontal gap",
      "min": 0, "max": 40, "step": 1, "unit": "px", "default": 12
    },

    { "type": "header", "content": "Section layout" },
    {
      "type": "select",
      "id": "section_width",
      "label": "Width",
      "options": [
        { "value": "page-width", "label": "Page" },
        { "value": "full-width", "label": "Full" }
      ],
      "default": "full-width"
    },
    { "type": "header", "content": "Padding" },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0, "max": 100, "step": 1, "unit": "px", "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0, "max": 100, "step": 1, "unit": "px", "default": 0
    }
  ],
  "presets": [
    {
      "name": "Multi-slide slideshow",
      "category": "Banners"
    }
  ]
}
{% endschema %}
